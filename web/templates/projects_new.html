<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –ò–ë</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<header class="topbar">
    <a href="/" class="logo">IB Integrator</a>

    <nav>
        <a href="/clients">–ö–ª–∏–µ–Ω—Ç—ã</a>
        <a href="/assets">–û–±—ä–µ–∫—Ç—ã –∑–∞—â–∏—Ç—ã</a>
        <a href="/projects">–ü—Ä–æ–µ–∫—Ç—ã</a>
        {{ if .IsAdmin }}
            <a href="/audit">–ê—É–¥–∏—Ç</a>
        {{ end }}
        <a href="/logout">–í—ã—Ö–æ–¥</a>
    </nav>

    <div class="user-info">
        {{ if .CurrentUser }}
            üë§ {{ .CurrentUser.Username }} ({{ .CurrentUser.Role }})
        {{ end }}
    </div>
</header>

<main class="content">
    <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ –ò–ë</h2>
    {{ if .error }}
        <div class="error">{{ .error }}</div>
    {{ end }}

    <form method="post" action="/projects/new">
        <div class="grid-2">
            <div class="card">
                <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>

                <div class="form-grid">
                    <label class="full">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ *
                        <input type="text" name="name" required placeholder="–ê—É–¥–∏—Ç –ò–ë, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –°–ó–ò, –ø–µ–Ω—Ç–µ—Å—Ç...">
                    </label>

                    <label>–ö–ª–∏–µ–Ω—Ç *
                        <select name="client_id" required>
                            <option value="">-- –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ --</option>
                            {{ range .clients }}
                                <option value="{{ .ID }}">{{ .Name }}</option>
                            {{ end }}
                        </select>
                    </label>

                    <label>–û–±—ä–µ–∫—Ç –∑–∞—â–∏—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                        <select name="asset_id">
                            <option value="">-- –Ω–µ –≤—ã–±—Ä–∞–Ω --</option>
                            {{ range .assets }}
                                <option value="{{ .ID }}">{{ .Name }}</option>
                            {{ end }}
                        </select>
                    </label>

                    <label>–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞ *
                        <select name="project_type" required>
                            <option value="audit">–ê—É–¥–∏—Ç –ò–ë</option>
                            <option value="szi_deploy">–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –°–ó–ò</option>
                            <option value="pentest">–ü–µ–Ω—Ç–µ—Å—Ç</option>
                            <option value="maintenance">–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ</option>
                            <option value="compliance">–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º</option>
                        </select>
                    </label>
                </div>
            </div>

            <div class="card">
                <h3>–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</h3>

                <div class="form-grid">
                    <label class="full">–ò–Ω–∂–µ–Ω–µ—Ä –ø–æ –ò–ë (–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π)
                        <select name="engineer_id">
                            <option value="">-- –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω --</option>
                            {{ range .engineers }}
                                <option value="{{ .ID }}">{{ .Username }}</option>
                            {{ end }}
                        </select>
                    </label>

                    <!-- –∫—Ä–∞—Å–∏–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç -->
                    <label class="full">–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Å—Ä–æ–∫–∏
                        <div class="date-range">
                            <div class="date-field">
                                <span class="date-caption">–ù–∞—á–∞–ª–æ</span>
                                <input type="date" name="planned_start" id="startDate">
                            </div>
                            <span class="date-sep">‚Üí</span>
                            <div class="date-field">
                                <span class="date-caption">–û–∫–æ–Ω—á–∞–Ω–∏–µ</span>
                                <input type="date" name="planned_end" id="endDate">
                            </div>
                        </div>
                    </label>

                    <label class="full">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç
                        <textarea name="description" placeholder="–ß—Ç–æ –¥–µ–ª–∞–µ–º –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞: —ç—Ç–∞–ø—ã, —Ü–µ–ª—å, –∫–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏."></textarea>
                    </label>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit">–°–æ–∑–¥–∞—Ç—å</button>
            <a href="/projects" class="btn secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const startInput = document.getElementById("startDate");
    const endInput = document.getElementById("endDate");

    if (!startInput || !endInput) {
        return;
    }

    // —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD
    const today = new Date().toISOString().split("T")[0];

    // –Ω–µ–ª—å–∑—è –≤—ã–±–∏—Ä–∞—Ç—å –¥–∞—Ç—ã –≤ –ø—Ä–æ—à–ª–æ–º
    startInput.min = today;
    endInput.min = today;

    // –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞
    startInput.addEventListener("change", () => {
        const val = startInput.value || today;
        endInput.min = val;
        if (endInput.value && endInput.value < val) {
            endInput.value = val;
        }
    });
});
</script>

</body>
</html>
